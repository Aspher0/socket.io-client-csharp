name: Publish
trigger: none

pool:
  vmImage: ubuntu-latest

parameters:
  - name: SocketIOClient
    displayName: SocketIOClient
    type: boolean
    default: false

jobs:
  - job:
    displayName: Publish
    steps:
      - ${{ if parameters.SocketIOClient }}:
        - task: CmdLine@2
          displayName: Publish to nuget.org
          inputs:
            workingDirectory: $(Agent.BuildDirectory)/s/src/SocketIOClient
            script: |
              dotnet pack -c Release --output $(Build.ArtifactStagingDirectory)
              $packageName = Get-ChildItem SocketIOClient.*.nupkg | Select-Object -First 1 -ExpandProperty Name
              dotnet nuget push $packageName --api-key AzureArtifacts --source nuget.org
